---
categories:
  - 2. 工作
  - Unity
---
# 蒙皮模型
## 蒙皮模型的结构
直接将蒙皮模型拖进场景中并观察其子节点，最简单的蒙皮模型中由骨架和蒙皮网格两部分组成。
- 骨架  
由一堆空物体组成，每个空物体代表一根骨骼。
- 蒙皮网格  
蒙皮网格比普通网格多了两个顶点属性，一是表明当前顶点所要跟随的骨骼，二是当跟随多根骨骼时权重分配（Unity中默认只支持4根），为了支持这两个新属性，蒙皮网格需要使用专门的SkinnedMeshRenderer组件。  
跟随骨骼的意思就好比把该顶点挂为该骨骼的子物体（实际上就是这个原理，只不过是用矩阵实现），从而当该骨骼移动旋转缩放时，顶点相对世界的位置信息也会发生变动。  
顶点跟随骨骼的具体矩阵实现：新顶点位置 =（世界空间到模型空间 * 骨骼空间到世界空间(该矩阵会跟随骨骼的变换而改变) * 初始模型空间到骨骼空间）* 初始顶点位置
## 顶点和骨骼之间的关联
蒙皮网格渲染器管理着顶点和骨骼之间的关联，但他是如何知道顶点该跟随哪根骨骼的呢？首先一个网格所用到的所有骨骼都肯定会被挂在一个根骨骼下，而顶点信息中保存着目标骨骼和根骨骼的相对层级关系，以及该骨骼的名称信息。利用这些，蒙皮网格渲染器便能找到每个顶点所需要的骨骼。
## 骨架共用的原理
由上文可见，顶点和骨骼并不是一个强绑定关系，而且蒙皮网格渲染器（下面简称渲染器）关联顶点和骨骼这一操作也只在渲染器启动时发生，所以只要在渲染器启动前准备好符合条件的空物体，渲染器也会将其识别为骨骼。实际上渲染器中也有提供修改根骨骼这一操作，便是起实现骨架共用的作用。
# 骨骼动画
动画即控制一个或多个属性，使其在时间的流逝中发生变化。而骨骼动画字如其名，即控制骨骼的动画。骨骼只是一个空物体，挂在它上面的只有Transform组件，因此能修改的也只有位置，旋转，缩放信息。通过调整这些属性来使特定的骨骼空间发生变动，从而导致蒙皮网格中的顶点相对世界的位置发生变化，便营造出来模型动了的感觉。
---
categories:
  - 2. 工作
  - Unity
---
以下内存分配均指持续堆内存分配。
# Linq
基本上使用就会分配内存，所以不要用。

# Foreach
不会分配内存，可以用，但速度不如For循环。

# 委托
只有使用匿名函数的方式创建时不会分配内存。
创建方式|是否分配内存|分配等级
--|--|--
静态函数|是|1
成员函数|是|1
局部函数|是|1
匿名函数|否|0
# 匿名函数
默认情况没有内存分配，但用到对象成员则分配内存加一，触发闭包再加一，避免这些情况。
## 在匿名函数内调用其他函数的情况
函数类型|是否分配内存|分配等级
--|--|--
静态函数|否|0
成员函数|是|1
成员局部函数|是|1
非成员局部函数|否|0
## 在匿名函数内使用其他变量的情况
变量类型|是否分配内存|分配等级
--|--|--
对象成员变量|是|1
作用域外变量|是|2
### 闭包（使用作用域外变量）
原先匿名函数不需要的创建内存此时也需要分配，并额外增加闭包数据的内存。
### 嵌套调用
通过嵌套调用也会触发以上情况。

# 装箱
会触发内存分配，不要使用。

# 字典
使用enum作为键实测并不会触发装箱，查看源代码就会发现，内部已经改为用泛型处理，所以没有内存分配。

# 字符串
字符串是引用类型，修改字符串实质是创建了一个新字符串，接着旧字符串将被回收，常见修改UI文字时出现。
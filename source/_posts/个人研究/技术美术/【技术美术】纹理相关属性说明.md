---
abbrlink: 3631212322
date: 2024-6-11 16:38
categories:
  - 个人研究
  - 技术美术
---

# 【技术美术】纹理相关属性说明

## 伽马与线性空间

伽马与线性空间都是一种颜色空间，也即颜色存储时的分布方式，伽马空间相比线性空间会更多的存储图片的暗色部分。

伽马空间现在是图片存储的标准格式。选择伽马空间的原因有两点：

1.  早期阴极射线管（CRT）显示器的输出会比输入颜色看上去偏暗，所以需要抬高输入值。
2.  人的眼睛对暗色比亮色更加敏感，所以更多的保存暗色，图片视觉效果也越保真。
3.  如今的显示器虽然可以实现线性输入输出，但也继承了 CRT 显示器的非线性特性。

线性空间更符合现实光线的物理特性，所以着色器计算需要线性空间颜色。

### sRGB

sRGB 是公认的标准伽马空间，所以 sRGB 也是图片的默认保存方式。

sRGB 的具体保存方式就是对原本的线性颜色值进行调色（$y=x^{\frac{1}{2.2}}$），从而牺牲亮色空间以存储更多暗色。

光照计算时需要线性颜色，因此使用 sRGB 纹理需先将颜色逆推转回线性空间（$y=x^{2.2}$），不然纹理就会看上去比原本亮的多。

### 颜色空间转换流程

在 PS、Unity（线性空间）工作流中，图片颜色空间转化过程如下：

1. 自然界颜色值（线性空间）0.2，在 PS 中显示为 0.5（伽马空间）。

   由于人眼感知的影响，我们不会发觉该值不是真正的中间值，而误以为它是黑白之间的灰色中性色。

2. 保存图片时继续以 0.5 存储（伽马空间）。

   对于颜色值，该值是错误的，与自然界不符，因此后续输出时需要矫正，但对非颜色值（如法线、光滑度、高度），该值是正确的，因此后续不能矫正颜色。

3. 在 Unity 中对颜色纹理启用 sRGB 选项后，Unity 将把纹理的 0.5（伽马空间）转为 0.2（线性空间）存储，并用于后续采样。

   此时 Unity 渲染管道中所用全部颜色值应都是线性值的，而这些颜色才是正确的，符合自然界值，因此可以用于光照物理的计算。

4. 渲染计算完毕后，Unity 将画面输出到帧缓冲区时，再次将颜色 0.2（线性空间）转为 0.5（伽马空间）存储。

   因为要兼容旧显示器输出画面会变暗的问题。此外还要考虑人眼特性，多存储暗色，否则看上去会有斑纹（图片精度低于人眼识别精度）

5. 显示器输出帧缓冲区内容，将缓冲区中的 0.5（伽马空间），输出为 0.2（线性空间）。

   线性空间才是自然界的颜色空间，因此显示屏输出画面到现实世界时需将伽马空间转为线性空间。此外该流程模拟了旧显示器的画面特性，从而实现兼容。

## mipmaps

mipmaps 是一种 GPU 采样策略。其先基于原纹理生成多张分辨率逐渐降低的小纹理，然后根据实际渲染时纹理在屏幕上的大小占比，选择其中最合适的纹理进行采样。

1. 分辨率降低以 2 的倍数进行，mipmap 等级越高分辨率越小。
2. 判断纹理占比大小的方式是通过`DDX`和`DDY`函数来对比当前像素与旁边像素的 uv 变化率来确定的，屏幕占比越小，变化率越大，采样所用的 mipmap 等级越大。

mipmaps 可以解决纹理分辨率和实际显示分辨率不同导致的过采样问题，具体而言有以下两点：

1. 减少过采样导致的性能浪费，因为分辨率越低的纹理采样性能越高。
2. 解决过采样导致的显示异常（摩尔纹）。

为了存储额外的低分辨率纹理，mipmaps 会占用一定额外空间，如果纹理的使用常见不存在上述问题（如 UI），则不应该使用 mipmap 功能。

### 各向异性

各项异性指物体从不同角度来看其性质会有所不同，放在纹理中是指 uv 两个轴的变化率不同：

- 如果正着看纹理，uv 双轴的变化率是差不多的，此时为各向同性。
- 如果倾斜看纹理，uv 双轴变化率可能相差非常大，此时为各项异性。

默认情况下 mipmaps 只考虑正视情况，生成的 mipmap 会均匀的混合周围所有的点，但倾斜时相比正视所能看到的点数量和位置是不同的。继续用这样的 mipmap 采样就会错误采到本该消失的点，导致出现晕影，看起来就像远处被模糊了一样。

所以启用 mipmaps 后应默认启用各项异性功能。这样 mipmaps 会额外存储一些不同宽高缩放比的 mipmap 以应对倾斜采样的情况。各向异性等级越高，这种 mipmap 就越多，应对能力也就越强。

## 过滤模式

指示 GPU 如何采用纹理。

- 点（无过滤）：只取 uv 最近像素的颜色信息。
- 双线性：取 uv 最近四个像素的颜色信息并混合。
- 三线性：对最近两张 mipmap 进行双线性采样，然后再混合。

## 寻址模式

指示 GPU 当采样时的 uv 输入值超出 $[0,1]$ 范围时如何处理。

- 重复：对输入值取模以纠正回范围内。
- 夹紧：将输入值限制在最大范围内。
- 镜像：类似乒乓的方式将输入值纠正回范围。
- 镜像一次：只在 $[-1,0]$ 范围内镜像一次，其他范围使用夹紧。

## 参考资料

- [Unity 文档-颜色空间](https://docs.unity.cn/cn/2022.3/Manual/LinearLighting.html)
- [Wikipedia-sRGB](https://en.wikipedia.org/wiki/SRGB)
- [游戏画面设置中的“各向异性过滤”是做什么的？](https://www.zhihu.com/question/411035839/answer/1986329452)
- [Unity 文档-纹理导入设置](https://docs.unity3d.com/2020.3/Documentation/Manual/class-TextureImporter.html)

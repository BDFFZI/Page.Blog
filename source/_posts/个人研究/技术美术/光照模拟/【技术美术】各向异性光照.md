---
categories:
  - 个人研究
  - 技术美术
  - 光照模拟
---

# 【技术美术】各项异性光照

## 各项同性与各项异性

一颗光滑的球被灯光照到，默认高光函数会形成一个圆斑，因为他用于计算高光的属性从任意表面向四周都是均匀相同的变化率（光滑的球面法线）。而在各向异性的表面上，则有可能形成条纹，因为其用于计算光照的属性，在条纹的垂直方向和水平方向上变化率是不同的（例如切线）。简要来说：

- 各项同性：从物体表面一点往四周出发，其属性变化率都是一致的。
- 各项异性：从物体表面一点往四周出发，其属性变化率根据具体方向会有明显差异。

所以实现各项异性光照的关键点在于，使用各方向变化率不同的属性计算。要获取各项异性的属性，方法有两种：

1. 从贴图上下手，绘制表面属性时就故意使其各方向变化率不一。
2. 从算法上下手，改用其他天生就各向异性的属性并设计专门的算法实现效果。

第一点对美术要求高，而且因为贴图分辨率的限制，效果不一定好，例如一根一根的头发丝非常多，不可能每根都在大小有限的贴图上表现的非常清楚。所以一般会采用第二种方法实现各向异性，也因此我们需要学习新的光照算法。

## Kajiya-Kay

Kajiya 是一种模仿各向异性高光的算法，其由 Blinn-Phong 改造而来，特点是不使用法线，而是使用天然就各项异性的切线代为计算光照数据。

![Kajiya-Kay](../../../../assets/images/509915-20230106093956857-466444544.png)

例如上图这个圆柱的高光，如果使用正常的 Blinn-Phong，其一定会形成一道顺着柱子的条纹高光，因为其上下的法线变化更缓，左右则更急，所以上下将会显示很多的高光。但我们希望实现的高光效果，则与其相反，希望其能沿着柱子显示，而不是上下。

如何实现？寻找一下圆柱周围一圈的相同点就会法线，其副切线都是一致的。不过负切线恰巧与法线垂直，所以基于法线的光照计算方法 $\cos(\theta)$ （$\theta$ 是 `normal` 和 `h` 的夹角）就不能用了，应改为 $\sin(\theta')$ ($\theta'$ 是 `bitangent` 和 `h` 的夹角)，不过 $\sin$ 不利于计算，但可利用三角函数关系式转换为 $\sqrt{1 - \cos^2(\theta')}$，这样就可以用点乘实现，即上图中的公式结果。

再配合上 Phong 中用次数（光泽度）和系数（亮度）校准的操作，我们便可以写出kk镜射光的具体代码了：

```hlsl
float kkSpecularTerm = pow(sqrt(1 - pow(dot(h, b), 2)), _Shininess) * _Brightness;
```

- b：副切线。

## 光照扰动

上述的 kk 实现后可以在球面上形成天使环的效果，但如果我们希望球面能表现头发效果的话，就必须实现一丝一丝的效果。方法很简单，同样是基于各向异性，让代表每根头发处的表面表现出不同的效果，从而营造出由密集的不同物体构成的感觉，即我们要打破天使环光滑的光斑效果。

此处我们就必须利用贴图来实现各向异性了，因为顶点无法承载如此高频的信息。我们可以搞一张带有密集条纹的噪波图来扰动用于计算的切线，扰动方式也很简单，直接用与其一起计算的法线即可，本质上就是调整了他们的光照角度。

```hlsl
float3 b = normalize(bitangent + normal * disturbance);
```
